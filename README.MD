# Chat Multi Usu√°rios

Aplica√ß√£o de chat multiusu√°rio constru√≠da em Node.js com Express, LangChain e OpenAI, permitindo m√∫ltiplas sess√µes independentes de conversa com hist√≥rico, temperatura e *system prompt* configur√°veis por sess√£o. 

---

## ‚ú® Funcionalidades

- ‚úÖ **Sess√µes de chat multiusu√°rio** via `sessionId` (UUID)
- üíæ **Hist√≥rico de mensagens por sess√£o** usando `LangChain` (`ChatMessageHistory`)
- üß† **Configura√ß√£o din√¢mica por sess√£o**:
  - `systemPrompt` (instru√ß√µes do sistema por sess√£o)
  - `temperature` (0‚Äì1 na API; controle via slider no front-end)
- ‚è±Ô∏è **Limpeza autom√°tica de sess√µes inativas** (30 minutos sem atividade)
- üåê **API REST documentada com Swagger** em `/api-docs`
- üíª **Interface web pronta**:
  - Tela inicial com ‚ÄúNova Sess√£o‚Äù e ‚ÄúContinuar Sess√£o‚Äù
  - Campo para colar o `sessionId` e retomar conversas
  - Slider de temperatura e campo de *system prompt*
  - Bot√µes de ‚ÄúLimpar Hist√≥rico‚Äù, ‚ÄúVer Hist√≥rico‚Äù e ‚ÄúNova Sess√£o‚Äù
  - Bot√£o para **copiar ID da sess√£o** (clipboard)

---

## üß± Tecnologias Utilizadas

- **Node.js** + **Express**
- **LangChain** (`@langchain/openai`, `@langchain/core`, `langchain`)
- **OpenAI API** (modelo padr√£o: `gpt-4.1-nano`)
- **Swagger UI** + `swagger.yaml` para documenta√ß√£o da API
- **CORS**, `dotenv`, `uuid`, `yamljs`
- Front-end em **HTML + CSS + JavaScript puro**

---

## üèóÔ∏è Arquitetura Geral

### Backend (Node + Express)

- Arquivo principal: `server.js`
- Armazena sess√µes em mem√≥ria usando um `Map`:

  - Cada sess√£o cont√©m:
    - `messageHistory` (`ChatMessageHistory`)
    - `systemPrompt`
    - `temperature`
    - `createdAt`
    - `lastActivity`

- Uso de `RunnableWithMessageHistory` para integrar LangChain + hist√≥rico por sess√£o.

#### Principais rotas da API

- `POST /api/session/new`  
  Cria uma nova sess√£o e retorna um `sessionId`.

- `GET /api/session/:sessionId/exists`  
  Verifica se uma sess√£o existe e retorna informa√ß√µes b√°sicas.

- `POST /api/chat`  
  Envia uma mensagem para a sess√£o:
  ```json
  {
    "sessionId": "uuid-da-sessao",
    "message": "Ol√°!",
    "temperature": 0.7,
    "systemPrompt": "Voc√™ √© um assistente educado."
  }
````

* `GET /api/session/:sessionId/history`
  Retorna o hist√≥rico de mensagens da sess√£o.

* `DELETE /api/session/:sessionId/clear`
  Limpa o hist√≥rico de uma sess√£o.

* `PUT /api/session/:sessionId/config`
  Atualiza `systemPrompt` e/ou `temperature` da sess√£o.

* `DELETE /api/session/:sessionId`
  Remove completamente a sess√£o.

* `GET /api/status`
  Retorna status b√°sico do servidor (uptime, n√∫mero de sess√µes).

* `GET /api-docs`
  Interface do Swagger UI, carregando `swagger.yaml`.

> ‚ö†Ô∏è As sess√µes s√£o mantidas **em mem√≥ria** e n√£o persistem se o servidor for reiniciado. criadas para fins de demonstra√ß√£o.

---

### Frontend (Interface Web)

* Arquivo principal: `index.html` 
* Single Page App simples, consumindo a API via `fetch`.

Principais caracter√≠sticas:

* Tela de boas-vindas com duas op√ß√µes:

  * **‚ûï Nova Sess√£o** ‚Üí faz `POST /api/session/new` e inicia o chat
  * **üîÑ Continuar Sess√£o** ‚Üí permite colar um `sessionId` e verifica em `/api/session/:sessionId/exists`
* √Årea de chat com:

  * Bal√µes de mensagem para usu√°rio e bot
  * Indicador de ‚Äúdigitando‚Äù animado
* Painel de par√¢metros:

  * Slider de **temperatura** (`input range`)
  * `textarea` para **system prompt** da sess√£o
* Bot√µes de a√ß√£o:

  * **Limpar Hist√≥rico** ‚Üí `DELETE /session/:id/clear`
  * **Ver Hist√≥rico** ‚Üí `GET /session/:id/history` (mostra resumo em `alert` + `console.log`)
  * **Nova Sess√£o** ‚Üí recarrega a p√°gina
* Bot√£o **‚ÄúCopiar ID da sess√£o‚Äù** usando `navigator.clipboard` ou *fallback* com `document.execCommand('copy')`.

> üîß No topo do script existe a constante `API_URL`. Ajuste para apontar para a URL/porta onde o backend est√° rodando (por exemplo, `http://localhost:3000/api`).

---

## üì¶ Requisitos

* **Node.js** (recomendado >= 18)
* **npm** ou **yarn**
* Chave da API da OpenAI (`OPENAI_API_KEY`)

---

## ‚öôÔ∏è Instala√ß√£o

1. Clone o reposit√≥rio ou copie os arquivos do projeto:

   ```bash
   git clone [url-do-repositorio](https://github.com/DevUnusual/avaliacao_comp_aplicada.git)
   cd avaliacao_comp_aplicada
   ```

2. Instale as depend√™ncias:

   ```bash
   npm install
   ```

3. Crie um arquivo `.env` na raiz do projeto:

   ```env
   OPENAI_API_KEY=coloque_sua_chave_aqui
   PORT=3000            # opcional, padr√£o 3000
   ```

---

## ‚ñ∂Ô∏è Execu√ß√£o

1. Inicie o servidor:

   ```bash
   node server.js
   ```

2. Acompanhe o log no terminal; ser√£o mostradas URLs como:

   * Interface (front-end): `http://localhost:3000`
   * Status: `http://localhost:3000/api/status`
   * Swagger UI: `http://localhost:3000/api-docs`

3. Abra o navegador e acesse a interface do chat:

   ```text
   http://localhost:3000
   ```

4. Escolha:

   * **Nova Sess√£o** para come√ßar do zero
   * **Continuar Sess√£o** se j√° tiver um `sessionId` salvo

---

## üß™ Exemplos de Uso com API (via cURL)

### Criar nova sess√£o

```bash
curl -X POST http://localhost:3000/api/session/new
```

### Enviar mensagem

```bash
curl -X POST http://localhost:3000/api/chat \
  -H "Content-Type: application/json" \
  -d '{
    "sessionId": "SEU_SESSION_ID",
    "message": "Ol√°, tudo bem?",
    "temperature": 0.7,
    "systemPrompt": "Voc√™ √© um assistente divertido."
  }'
```

### Ver hist√≥rico da sess√£o

```bash
curl http://localhost:3000/api/session/SEU_SESSION_ID/history
```

---